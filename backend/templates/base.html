<!DOCTYPE html>
<title>{% block title %}{% endblock %} - Flaskr</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Kanit&family=Montserrat&family=Open+Sans:wght@500&display=swap"
	rel="stylesheet" />

<body>
	<div class="full-body-container">
		<div class="top-text">
			<div class="google-colors">
				<h1 id="title-color">CuisineCheck</h1>
				<p id="small-title">Philadelphia</p>
			</div>
			<div class="search-box" onclick="sendFocus()">
				<input placeholder="Search for your favorite restaurant" id="filter-text-val" onkeyup="filterText()" />
			</div>
		</div>
		<div id="answer-box"></div>
	</div>

	<script>
		function answerBoxTemplate(
			name,
			address,
			stars,
			categories,
			review,
			match
		) {
			if (document.getElementById('filter-text-val').value == '') {
				return ``;
			}
			const bgColor = match ? '#fff6f6' : '#f9f9f9';
			return `<div class='border box-template' style='background-color: ${bgColor};'>
                <h3 class='episode-title'>${name}</h3>
                <p class='company-address'>${address}</p>
                <p class='star-ratings'>${'<span></span>'.repeat(stars)}</p>
                <p class='category-list'>${categories}</p>
                <p class='review' style='margin-top: 15px;'>Most useful review: ${review}</p>
            </div>`;
		}

		function sendFocus() {
			document.getElementById('filter-text-val').focus();
		}

		function filterText() {
			document.getElementById('answer-box').innerHTML = '';
			console.log(document.getElementById('filter-text-val').value);
			var searchParams = new URLSearchParams({
				title: document.getElementById('filter-text-val').value
			})
			searchParams.append("blacklist", "Wine Thief") // # Temp example for search "Marathon Grill"
			searchParams.append("min_rating", 3) // temp value for min_rating
			fetch(
				'/episodes?' + searchParams.toString()
			)
				.then((response) => response.json())
				.then((data) =>
					data.forEach((row, index) => {
						if (index == 0) {
							// Query company
							console.log('User query company info: ', row);
							let tempDiv = document.createElement('div');
							tempDiv.innerHTML = answerBoxTemplate(
								row.name,
								row.address,
								row.stars,
								row.categories,
								row.useful_review,
								true
							); // TODO: Change to show more attributes than just name and useful review
							document.getElementById('answer-box').appendChild(tempDiv);
						} else {
							row.forEach((r, i) => {
								// Matched comapny
								console.log('Match #', i + 1, ' company info: ', r);
								let tempDiv = document.createElement('div');
								tempDiv.innerHTML = answerBoxTemplate(
									r.name,
									r.address,
									r.stars,
									r.categories,
									r.useful_review,
									false
								); // TODO: Change to show more attributes than just name and useful review
								document.getElementById('answer-box').appendChild(tempDiv);
							});
						}
					})
				);
		}
	</script>
</body>